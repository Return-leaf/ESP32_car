# ESP32_car
# myESP32_car
1. 项目概述
本程序是一个基于 ESP32-S3 芯片、双 L298N 驱动板 与 微信小程序 交互的物联网控制系统。通过 WebSocket 协议实现低延迟的实时操控，支持摇杆控制方向、多挡位调速以及特殊的“漂移模式”。

硬件架构
2.1 核心组件
控制器：ESP32-S3 (双核 CPU, 支持 Wi-Fi & 蓝牙)

电机驱动：L298N 或 TB6612FNG 驱动模块

底盘：四驱（4WD）或后驱小车底盘

2.2 引脚映射表组件功能ESP32-S3 
引脚电机 A (左侧)方向 (IN1/IN2, IN3/IN4)GPIO 4, 5, 6, 7
电机 B (右侧)方向 (IN1/IN2, IN3/IN4)GPIO 15, 16, 17, 18
速度控制PWM 使能 (ENA/ENB)GPIO 1, 2, 42, 41

3. 软件逻辑
3.1 通信协议 (WebSocket)
小程序与小车之间采用字符串格式通信："方向:速度"

示例："forward:180" -> 前进，速度 180 (PWM)

示例："drift_l:255" -> 开启左漂移，强制最高速

3.2 操控算法 (摇杆判向)利用数学函数 atan2(dy, dx)$将摇杆的 360° 触控区域划分为四个 90° 的扇区：
前进：-135 至 -45 右转：-45 至 45 后退：45 至 135  左转：135 或 -135

4. 特色功能：漂移模式 (Drift Mode)
4.1 物理原理
普通转向采用单侧差速（一侧转，一侧停），而漂移模式采用坦克转向（一侧正转，一侧反转），瞬间产生巨大的力矩，使车尾甩出。

逻辑代码实现：
if (dir == "drift_l") {
    // 左侧电机反转 + 右侧电机正转 + 满额动力
    digitalWrite(左反, HIGH); 
    digitalWrite(右正, HIGH);
    speed = 255; 
}

5. 快速启动与调试
环境配置：

手机开启热点：OPPO_car / 1379258046 (2.4GHz)。

通过 Arduino 串口监视器获取小车 IP。

小程序连接：

在 index.js 的 initSocket 函数中填入最新 IP 地址。

连接状态灯变绿（Online）即可开始操控。

安全保护：

系统具备断开保护逻辑，WebSocket 连接丢失时小车会自动 stopAll()。

6. 未来扩展建议
传感器接入：通过 GPIO 引脚接入 HC-SR04 超声波传感器实现自动避障。

视觉方案：由于 ESP32-S3 支持摄像头，可升级为实时图传（mjpeg stream）。

能源管理：建议增加分压电路测量电池电压，并在小程序界面同步显示剩余电量。
